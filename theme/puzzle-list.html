<!DOCTYPE html>
<html>
  <head>
    <title>Open Puzzles</title>
    <link rel="stylesheet" href="basic.css">
    <meta name="viewport" content="width=device-width">
    <meta charset="utf-8">
    <script>

function render(obj) {
  puzzlesElement = document.createElement('div');

  // Create a sorted list of category names
  let cats = Object.keys(obj);
  cats.sort();

  for (let cat of cats) {
    if (cat.startsWith("__")) {
      // Metadata or something
      continue;
    }
    let puzzles = obj[cat];
    
    let pdiv = document.createElement('div');
    pdiv.className = 'category';
    
    let h = document.createElement('h2');
    pdiv.appendChild(h);
    h.textContent = cat;
    
    // Extras if we're running a devel server
    if (obj.__devel__) {
      var a = document.createElement('a');
      h.insertBefore(a, h.firstChild);
      a.textContent = "⬇️";
      a.href = "mothballer/" + cat;
      a.classList.add("mothball");
      a.title = "Download a compiled puzzle for this category";
    }

    let l = document.createElement('ul');
    pdiv.appendChild(l);

    for (var puzzle of puzzles) {
      var points = puzzle[0];
      var id = puzzle[1];
  
      var i = document.createElement('li');
      l.appendChild(i);
      i.textContent = " ";
  
      if (points === 0) {
        // Sentry: there are no more puzzles in this category
        i.textContent = "✿";
      } else {
        var a = document.createElement('a');
        i.appendChild(a);
        a.textContent = points;
        a.href = "puzzle.html?cat=" + cat + "&points=" + points + "&pid=" + id;
      }
    }
    
    puzzlesElement.appendChild(pdiv);
    document.getElementById("puzzles").appendChild(puzzlesElement);
  }
}

function init() {
  fetch("puzzles.json")
  .then(resp => {
    return resp.json();
  })
  .then(obj => {
    render(obj);
  })
  .catch(err => {
    console.log("Error", err);
  });
}

if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", init);
} else {
  init();
}
    </script>
  </head>
  <body>
    <h1 class="Success">Open Puzzles</h1>
    <section>
      <div id="puzzles"></div>
    </section>
    <nav>
      <ul>
        <li><a href="puzzle-list.html">Puzzles</a></li>
        <li><a href="scoreboard.html">Scoreboard</a></li>
      </ul>
    </nav>
  </body>
</html>
